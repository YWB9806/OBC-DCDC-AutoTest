# 完整部署流程指南

## 📋 部署流程概览

```
✅ 步骤1: 本地打包测试 (已完成)
⬇️
📦 步骤2: 创建发布包
⬇️
🔖 步骤3: 提交代码并打标签
⬇️
🚀 步骤4: GitHub自动发布
⬇️
✅ 步骤5: 验证发布
```

---

## ✅ 步骤1: 本地打包测试（已完成）

- ✅ 打包成功
- ✅ 应用可以正常运行
- ✅ 所有功能正常

---

## 📦 步骤2: 创建发布包

### 2.1 创建Windows安装包

```bash
# 在项目根目录执行
cd dist

# 创建ZIP压缩包
powershell -Command "Compress-Archive -Path OBC-DCDC-AutoTest -DestinationPath OBC-DCDC-AutoTest-1.0.0-Windows.zip -Force"

# 返回项目根目录
cd ..
```

### 2.2 验证压缩包

```bash
# 检查文件是否存在
dir dist\OBC-DCDC-AutoTest-1.0.0-Windows.zip
```

**预期结果**：
- 文件大小约 100-200 MB
- 可以正常解压

---

## 🔖 步骤3: 提交代码并打标签

### 3.1 检查当前状态

```bash
# 查看修改的文件
git status
```

### 3.2 提交所有更改

```bash
# 添加所有文件
git add .

# 提交
git commit -m "feat: 添加版本发布和自动更新系统

- 添加版本管理配置
- 添加自动更新检查功能
- 添加GitHub Actions自动构建
- 添加发布脚本和文档
- 配置PyQt5和Python 3.8+兼容性"

# 推送到GitHub
git push origin main
```

### 3.3 创建版本标签

```bash
# 创建标签
git tag -a v1.0.0 -m "Release version 1.0.0

首个正式版本发布

主要功能：
- Python脚本批量执行
- 用户认证和权限管理
- 实时输出监控
- 执行历史记录
- 测试套件管理
- 性能监控
- 数据备份
- 插件系统
- 自动更新检查"

# 推送标签到GitHub（触发自动构建）
git push origin v1.0.0
```

---

## 🚀 步骤4: GitHub自动发布

### 4.1 查看构建进度

推送标签后，GitHub Actions会自动开始构建：

1. 访问：https://github.com/YWB9806/OBC-DCDC-AutoTest/actions
2. 查看最新的工作流运行
3. 等待构建完成（约10-20分钟）

### 4.2 构建过程

GitHub Actions会自动：
- ✅ 在Windows上构建
- ✅ 在Linux上构建
- ✅ 在macOS上构建
- ✅ 创建GitHub Release
- ✅ 上传所有平台的安装包

### 4.3 监控构建状态

**构建成功标志**：
- ✅ 所有构建任务显示绿色勾号
- ✅ Release页面出现新版本
- ✅ 所有安装包已上传

**如果构建失败**：
1. 点击失败的任务查看日志
2. 根据错误信息修复问题
3. 重新推送标签

---

## ✅ 步骤5: 验证发布

### 5.1 检查Release页面

访问：https://github.com/YWB9806/OBC-DCDC-AutoTest/releases

**验证内容**：
- [ ] Release v1.0.0 已创建
- [ ] 发布说明正确显示
- [ ] 包含3个安装包：
  - [ ] OBC-DCDC-AutoTest-Windows.zip
  - [ ] OBC-DCDC-AutoTest-Linux.tar.gz
  - [ ] OBC-DCDC-AutoTest-macOS.tar.gz

### 5.2 测试下载和安装

```bash
# 下载Windows版本
# 从Release页面下载 OBC-DCDC-AutoTest-Windows.zip

# 解压到新目录
# 运行测试
```

### 5.3 测试自动更新功能

1. 运行旧版本应用（如果有）
2. 应该看到更新提示
3. 点击"立即下载"应该打开Release页面

---

## 📝 步骤6: 更新文档和通知

### 6.1 更新README.md

在项目README中添加下载链接：

```markdown
## 📥 下载

最新版本：[v1.0.0](https://github.com/YWB9806/OBC-DCDC-AutoTest/releases/tag/v1.0.0)

- [Windows版本](https://github.com/YWB9806/OBC-DCDC-AutoTest/releases/download/v1.0.0/OBC-DCDC-AutoTest-Windows.zip)
- [Linux版本](https://github.com/YWB9806/OBC-DCDC-AutoTest/releases/download/v1.0.0/OBC-DCDC-AutoTest-Linux.tar.gz)
- [macOS版本](https://github.com/YWB9806/OBC-DCDC-AutoTest/releases/download/v1.0.0/OBC-DCDC-AutoTest-macOS.tar.gz)
```

### 6.2 更新CHANGELOG.md

确保CHANGELOG.md包含最新版本的更新内容。

---

## 🎯 快速部署命令

如果你想快速完成整个流程，可以使用发布脚本：

```bash
# 方式1: 使用发布脚本（推荐）
release.bat 1.0.0

# 方式2: 手动执行
git add .
git commit -m "feat: 添加版本发布系统"
git push origin main
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

---

## 📊 部署检查清单

### 发布前检查
- [ ] 本地打包测试通过
- [ ] 应用功能正常
- [ ] 版本号已更新（version.py）
- [ ] CHANGELOG已更新
- [ ] 所有代码已提交

### 发布中检查
- [ ] 代码已推送到GitHub
- [ ] 标签已创建并推送
- [ ] GitHub Actions构建中
- [ ] 监控构建状态

### 发布后检查
- [ ] Release已创建
- [ ] 所有安装包已上传
- [ ] 下载链接可用
- [ ] 安装包可以正常使用
- [ ] 自动更新功能正常
- [ ] README已更新

---

## 🔄 后续版本发布

### 发布新版本（如v1.1.0）

1. **更新代码**
   ```bash
   # 开发新功能...
   ```

2. **更新版本号**
   ```python
   # 编辑 version.py
   __version__ = "1.1.0"
   VERSION = {
       "major": 1,
       "minor": 1,
       "patch": 0,
       "release_date": "2025-12-14",
   }
   ```

3. **更新CHANGELOG**
   ```markdown
   ## [1.1.0] - 2025-12-14
   ### 新增
   - 新功能描述
   ```

4. **本地测试**
   ```bash
   python run.py
   pyinstaller build.spec
   ```

5. **发布**
   ```bash
   release.bat 1.1.0
   ```

---

## 🐛 常见问题

### Q1: GitHub Actions构建失败怎么办？

**A**: 
1. 查看Actions日志找到错误原因
2. 常见原因：
   - 依赖缺失：更新requirements.txt
   - 路径错误：检查build.spec
   - 权限问题：检查GitHub仓库设置

### Q2: 如何删除错误的Release？

**A**:
1. 访问Release页面
2. 点击要删除的Release
3. 点击"Delete"按钮
4. 删除对应的标签：`git push --delete origin v1.0.0`

### Q3: 如何修改已发布的Release？

**A**:
1. 访问Release页面
2. 点击"Edit"按钮
3. 修改内容后保存

---

## 📞 获取帮助

- 📖 [发布部署指南](./发布部署指南.md)
- 📖 [打包测试指南](./打包测试指南.md)
- 🐛 [提交Issue](https://github.com/YWB9806/OBC-DCDC-AutoTest/issues)

---

**创建时间**: 2025-12-13  
**适用版本**: v1.0.0+